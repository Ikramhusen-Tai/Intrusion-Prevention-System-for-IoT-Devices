<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Smart Home IPS - Devices</title>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    >

    <style>
        body {
            font-size: 1.05rem;
        }

        .btn-ips {
            background-color: #4b4b4b;
            color: #ffffff;
            border: none;
        }
        .btn-ips:hover {
            background-color: #3a3a3a;
            color: #ffffff;
        }

        .btn-ips-outline {
            border: 1px solid #4b4b4b;
            color: #4b4b4b;
            background: transparent;
        }
        .btn-ips-outline:hover {
            background-color: #4b4b4b;
            color: white;
        }

        .navbar-nav .nav-link:hover {
            color: #ffffff !important;
            background-color: #333333;
            border-radius: 6px;
        }
        .navbar-nav .nav-link.active {
            font-weight: 500;
            
        }

        .card-header {
            font-weight: 600;
        }
    
        .navbar-brand.fs-1 {
            font-size: clamp(1.35rem, 3.2vw, 2.5rem) !important;
        }
        .brand-wrap {
            display: inline-flex;
            align-items: center;
            gap: clamp(6px, 1.2vw, 12px);
            flex-wrap: wrap;          
        }
        .brand-text {
            line-height: 1.05;
        }
        .router-icon {
            width: clamp(35px, 3.5vw, 60px);
            height: auto;
            flex: 0 0 auto;
            opacity: 0.95;
        }
        @media (max-width: 576px) {
            .brand-wrap { gap: 8px; }
            .router-icon { width: 22px; }
        }

    </style>
</head>

<body class="bg-light">

<!-- Global Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark"
     style="background-color:#1f1f1f; padding: 1rem 1rem;">
  <div class="container-fluid px-4 px-lg-5">

    <!-- Brand -->
    <a class="navbar-brand fw-bold fs-1"
       href="{{ url_for('index') }}"
       style="letter-spacing:0.5px; color:#fff; text-shadow:0 1px 3px rgba(0,0,0,0.55);">
      <span class="brand-wrap"><span class="brand-text">Smart Home Router</span>
      <svg class="router-icon" viewBox="0 0 64 64" fill="none"
         xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <rect x="6" y="28" width="52" height="18" rx="3"
            stroke="white" stroke-width="2"/>
      <circle cx="18" cy="37" r="2" fill="white"/>
      <circle cx="26" cy="37" r="2" fill="white"/>
      <circle cx="34" cy="37" r="2" fill="white"/>
      <line x1="20" y1="28" x2="14" y2="16"
            stroke="white" stroke-width="2"/>
      <line x1="32" y1="28" x2="32" y2="14"
            stroke="white" stroke-width="2"/>
      <line x1="44" y1="28" x2="50" y2="16"
            stroke="white" stroke-width="2"/>
    </svg>
    </span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto align-items-lg-center">

        <li class="nav-item">
          <a class="nav-link {% if active_page=='devices' %}active fw-semibold{% endif %} fs-5 px-3"
             href="{{ url_for('index') }}">Devices</a>
        </li>

        <li class="nav-item">
          <a class="nav-link {% if active_page=='firewall' %}active fw-semibold{% endif %} fs-5 px-3"
             href="{{ url_for('firewall_page') }}">Firewall</a>
        </li>
        
         <li class="nav-item">
          <a class="nav-link {% if active_page=='ips' %}active fw-semibold{% endif %} fs-5 px-3"
             href="{{ url_for('ips_dashboard') }}">IPS</a>
        </li>

        <li class="nav-item">
          <a class="nav-link {% if active_page=='alerts' %}active fw-semibold{% endif %} fs-5 px-3"
             href="{{ url_for('ips_alerts_live') }}">
            Alerts
            {% if has_unseen_alerts %}
              <span class="badge bg-danger ms-2" title="New alerts">!</span>
            {% endif %}
          </a>
        </li>

       

        <li class="nav-item">
          <a class="btn btn-sm btn-outline-danger ms-3 px-3 py-2 fw-semibold"
             href="{{ url_for('logout') }}">
            Logout
          </a>
        </li>

      </ul>
    </div>
  </div>
</nav>


<div class="container-fluid px-4 px-lg-5 py-5">

    <!-- Page Title -->
    <h1 class="h3 mb-2">Devices</h1>
    <p class="text-muted mb-4">Discover and manage devices on your smart home network.</p>

    <!-- Network Scan -->
    <div class="card mb-4">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <h2 class="h6 mb-1">Network Scan</h2>
                <small class="text-muted">Scan the network to discover currently connected devices.</small>
            </div>
            <a href="{{ url_for('scan') }}" class="btn btn-ips px-4">
                Scan Network
            </a>
        </div>
    </div>

    <!-- Currently Connected -->
    <div class="card mb-4">
        <div class="card-header">Currently Connected Devices</div>
        <div class="card-body p-0">

            {% if online_devices %}
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>IP</th>
                            <th>MAC</th>
                            <th>Name</th>
                            <th>Vendor</th>
                            <th>Model</th>
                            <th>Last Seen</th>
                            <th>Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                    {% for d in online_devices %}
                    <tr>
                        <td>{{ d.ip }}</td>
                        <td>{{ d.mac }}</td>

                        <td>
                          <form method="post" action="{{ url_for('edit_device', device_id=d.id) }}"
                                class="row g-2 align-items-center">
                            <div class="col-md-12">
                              <input type="text" name="name" value="{{ d.name or '' }}"
                                     class="form-control form-control-sm" placeholder="Device name">
                            </div>
                        </td>

                        <td>
                            <input type="text" name="vendor" value="{{ d.vendor or '' }}"
                                   class="form-control form-control-sm" placeholder="Vendor">
                        </td>

                        <td>
                            <input type="text" name="model" value="{{ d.model or '' }}"
                                   class="form-control form-control-sm" placeholder="Model">
                        </td>

                        <td class="text-nowrap">{{ d.last_seen }}</td>

                        <td class="text-nowrap">
                            <button class="btn btn-sm btn-ips me-1" type="submit">Save</button>
                            <a class="btn btn-sm btn-ips-outline"
                               href="{{ url_for('device_detail', device_id=d.id) }}">
                               View
                            </a>
                          </form>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>

                </table>
            </div>

            {% else %}
            <p class="p-3 mb-0">No devices currently online.</p>
            {% endif %}
        </div>
    </div>


    <!-- Previously Connected -->
    <div class="card">
        <div class="card-header">Previously Connected Devices</div>
        <div class="card-body p-0">

            {% if offline_devices %}
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>IP (last)</th>
                            <th>MAC</th>
                            <th>Name</th>
                            <th>Vendor</th>
                            <th>Model</th>
                            <th>Last Seen</th>
                            <th>Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                    {% for d in offline_devices %}
                    <tr>
                        <td>{{ d.ip }}</td>
                        <td>{{ d.mac }}</td>

                        <td>
                          <form method="post" action="{{ url_for('edit_device', device_id=d.id) }}"
                                class="row g-2 align-items-center">
                            <div class="col-md-12">
                              <input type="text" name="name" value="{{ d.name or '' }}"
                                     class="form-control form-control-sm" placeholder="Device name">
                            </div>
                        </td>

                        <td>
                            <input type="text" name="vendor" value="{{ d.vendor or '' }}"
                                   class="form-control form-control-sm" placeholder="Vendor">
                        </td>

                        <td>
                            <input type="text" name="model" value="{{ d.model or '' }}"
                                   class="form-control form-control-sm" placeholder="Model">
                        </td>

                        <td class="text-nowrap">{{ d.last_seen }}</td>

                        <td class="text-nowrap">
                            <button class="btn btn-sm btn-ips me-1" type="submit">Save</button>
                            <a class="btn btn-sm btn-ips-outline"
                               href="{{ url_for('device_detail', device_id=d.id) }}">
                               View
                            </a>
                          </form>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>

                </table>
            </div>

            {% else %}
            <p class="p-3 mb-0">No previously connected devices yet.</p>
            {% endif %}
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>

